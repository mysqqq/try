<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FB Auto Share</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #000000;
            color: #ffffff;
            padding: 60px 20px 40px;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 380px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 20px;
            font-weight: 600;
            color: #ffffff;
            letter-spacing: 1px;
        }

        .section {
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 12px;
            color: #888888;
            margin-bottom: 7px;
            font-weight: 500;
            letter-spacing: 0.3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .helper-link {
            font-size: 11px;
            color: #0066ff;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .helper-link:hover {
            color: #0088ff;
            text-decoration: underline;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 9px 11px;
            border-radius: 6px;
            color: #ffffff;
            font-size: 12px;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', monospace;
            resize: none;
            transition: border-color 0.2s ease, background 0.2s ease;
        }

        input[type="text"]::placeholder,
        input[type="number"]::placeholder,
        textarea::placeholder {
            font-size: 11px;
            color: #555555;
        }

        input.error,
        textarea.error {
            border-color: #ff4444;
        }

        textarea {
            min-height: 42px;
            font-family: monospace;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #404040;
            background: #1f1f1f;
        }

        input.error:focus,
        textarea.error:focus {
            border-color: #ff4444;
        }

        .error-message {
            font-size: 11px;
            color: #ff4444;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }

        .error-message.show {
            display: block;
        }

        .submit-btn {
            background: #ffffff;
            color: #000000;
            border: none;
            padding: 12px 24px;
            width: auto;
            min-width: 120px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin: 12px auto 0;
            display: block;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
        }

        .submit-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .submit-btn:active {
            background: #e0e0e0;
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background: #2a2a2a;
            color: #555555;
            cursor: not-allowed;
            transform: none;
        }

        .session-id-display {
            margin-top: 12px;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            border-radius: 6px;
            font-size: 11px;
            color: #888888;
            text-align: center;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            display: none;
        }

        .session-id-display.show {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .session-id-label {
            color: #666666;
            margin-right: 8px;
        }

        .session-id-value {
            color: #ffffff;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #1a1a1a;
        }

        .footer-text {
            font-size: 10px;
            color: #555555;
            letter-spacing: 0.5px;
        }

        .success-box {
            background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
            color: #ffffff;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.3px;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .success-box.show {
            opacity: 1;
            transform: scale(1);
        }

        .session-active-box {
            background: #1a1a1a;
            border: 1px solid #00ff88;
            color: #00ff88;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.3px;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .session-active-box.show {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .error-box {
            background: #1a1a1a;
            border: 1px solid #ff4444;
            color: #ff4444;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.3px;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .error-box.show {
            opacity: 1;
            transform: scale(1);
        }

        .processing-box {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 14px;
            border-radius: 6px;
            margin-top: 18px;
            opacity: 0;
            transform: scale(0.95);
            font-size: 13px;
            text-align: center;
            color: #888888;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .processing-box.show {
            opacity: 1;
            transform: scale(1);
        }

        .processing-dots {
            display: inline-block;
            margin-left: 4px;
        }

        .processing-dots span {
            animation: blink 1.4s infinite;
            opacity: 0.3;
        }

        .processing-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .processing-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .session-controls {
            display: none;
            margin-top: 18px;
            gap: 10px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .session-controls.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .check-btn,
        .delete-btn {
            flex: 1;
            padding: 11px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
        }

        .check-btn {
            background: #ffffff;
            color: #000000;
        }

        .check-btn:hover {
            background: #f0f0f0;
            transform: translateY(-1px);
        }

        .delete-btn {
            background: #1a1a1a;
            color: #cccccc;
            border: 1px solid #2a2a2a;
        }

        .delete-btn:hover {
            background: #252525;
            border-color: #333333;
        }

        .status-box {
            background: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 16px;
            border-radius: 6px;
            margin-top: 18px;
            display: none;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .status-box.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #252525;
            font-size: 12px;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            color: #888888;
            font-weight: 500;
        }

        .status-value {
            color: #ffffff;
            font-weight: 600;
        }

        .status-active {
            color: #00ff88;
        }

        .status-completed {
            color: #0066ff;
        }

        .status-failed {
            color: #ff4444;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #2a2a2a;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0066ff, #00ff88);
            width: 0%;
            transition: width 0.5s ease;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
            }
            
            body {
                padding: 50px 16px 30px;
            }

            .header-title {
                font-size: 18px;
            }

            .submit-btn {
                min-width: 100px;
                padding: 11px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="header-title">AUTO SHARE</h1>
        </div>

        <div class="section">
            <div class="section-title">
                <span>Cookie</span>
                <a href="https://chromewebstore.google.com/detail/get-token-cookie/naciaagbkifhpnoodlkhbejjldaiffcm" target="_blank" class="helper-link">Get Cookie</a>
            </div>
            <textarea id="cookieInput" placeholder="Paste your Facebook cookie here..."></textarea>
            <div class="error-message" id="cookieError">Please enter your Facebook cookie</div>
        </div>

        <div class="section">
            <div class="section-title">Link</div>
            <input type="text" id="linkInput" placeholder="https://www.facebook.com/...">
            <div class="error-message" id="linkError">Please enter a valid Facebook link</div>
        </div>

        <div class="section">
            <div class="section-title">Amount</div>
            <input type="number" id="amountInput" placeholder="Enter amount" min="1">
            <div class="error-message" id="amountError">Please enter amount</div>
        </div>

        <div class="section">
            <div class="section-title">Delay</div>
            <input type="number" id="delayInput" placeholder="Enter delay (seconds)" min="0">
            <div class="error-message" id="delayError">Please enter delay</div>
        </div>

        <button class="submit-btn" id="submitBtn">Submit</button>

        <div class="session-id-display" id="sessionIdDisplay">
            <span class="session-id-label">Session ID:</span>
            <span class="session-id-value" id="sessionIdValue">—</span>
        </div>

        <div class="footer">
            <div class="footer-text">© 2026 | Siegfried Samá</div>
        </div>

        <div class="error-box" id="errorBox">
            Please fix the errors above
        </div>

        <div class="processing-box" id="processingBox">
            Processing<span class="processing-dots"><span>.</span><span>.</span><span>.</span></span>
        </div>

        <div class="success-box" id="successBox">
            Sharing started successfully
        </div>

        <div class="session-active-box" id="sessionActiveBox">
            Session is running
        </div>

        <div class="session-controls" id="sessionControls">
            <button class="delete-btn" id="deleteBtn">Delete</button>
            <button class="check-btn" id="checkBtn">Check</button>
        </div>

        <div class="status-box" id="statusBox">
            <div class="status-item">
                <span class="status-label">Facebook Link</span>
                <span class="status-value" id="sessionLink" style="font-size: 10px; word-break: break-all;">—</span>
            </div>
            <div class="status-item">
                <span class="status-label">Session ID</span>
                <span class="status-value" id="sessionId">—</span>
            </div>
            <div class="status-item">
                <span class="status-label">Status</span>
                <span class="status-value status-active" id="statusValue">Active</span>
            </div>
            <div class="status-item">
                <span class="status-label">Progress</span>
                <span class="status-value" id="progressValue">0 / 0</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="status-item">
                <span class="status-label">Started</span>
                <span class="status-value" id="startTime">—</span>
            </div>
            <div class="status-item">
                <span class="status-label">Estimated Time</span>
                <span class="status-value" id="estimatedTime">—</span>
            </div>
        </div>
    </div>

    <script>
        (function() {
            let currentSession = null;
            let progressInterval = null;
            let startTimestamp = null;

            const $ = (id) => document.getElementById(id);
            const el = {
                submit: $('submitBtn'),
                processing: $('processingBox'),
                success: $('successBox'),
                sessionActive: $('sessionActiveBox'),
                error: $('errorBox'),
                sessionControls: $('sessionControls'),
                statusBox: $('statusBox'),
                checkBtn: $('checkBtn'),
                deleteBtn: $('deleteBtn'),
                progressFill: $('progressFill'),
                sessionIdDisplay: $('sessionIdDisplay'),
                sessionIdValue: $('sessionIdValue'),
                cookie: $('cookieInput'),
                link: $('linkInput'),
                amount: $('amountInput'),
                delay: $('delayInput'),
                cookieErr: $('cookieError'),
                linkErr: $('linkError'),
                amountErr: $('amountError'),
                delayErr: $('delayError')
            };

            const msg = {
                invalidCookie: 'Please generate a new cookie and try again. The current cookie is invalid, expired, or restricted.',
                apiError: 'Unable to process your request. Please check your cookie and link, then try again.',
                noSession: 'No active session'
            };

            const cls = (e, c, add) => add ? e.classList.add(c) : e.classList.remove(c);
            
            const clearErr = (input, err) => {
                cls(input, 'error', false);
                cls(err, 'show', false);
            };

            const showErr = (input, err, txt) => {
                cls(input, 'error', true);
                if (txt) err.textContent = txt;
                cls(err, 'show', true);
            };

            const validateLink = (url) => {
                if (!url) return false;
                return [
                    /^(https?:\/\/)?(www\.)?facebook\.com\/.+/i,
                    /^(https?:\/\/)?(www\.)?fb\.watch\/.+/i,
                    /^(https?:\/\/)?m\.facebook\.com\/.+/i,
                    /^(https?:\/\/)?mobile\.facebook\.com\/.+/i
                ].some(p => p.test(url));
            };

            const validateInputs = () => {
                let valid = true;
                cls(el.error, 'show', false);

                if (!el.cookie.value.trim()) {
                    showErr(el.cookie, el.cookieErr);
                    valid = false;
                }

                if (!validateLink(el.link.value.trim())) {
                    showErr(el.link, el.linkErr);
                    valid = false;
                }

                const amt = el.amount.value.trim();
                if (!amt || parseInt(amt) < 1) {
                    showErr(el.amount, el.amountErr);
                    valid = false;
                }

                const dly = el.delay.value.trim();
                if (dly === '' || parseInt(dly) < 0) {
                    showErr(el.delay, el.delayErr);
                    valid = false;
                }

                return valid;
            };

            const validateAPI = async (url) => {
                try {
                    const res = await fetch(url);
                    if (res.status >= 400) return { valid: false, error: msg.invalidCookie };

                    let data;
                    try {
                        const txt = await res.text();
                        if (txt.trim()) data = JSON.parse(txt);
                        else return { valid: true, data: {} };
                    } catch (e) {
                        return { valid: true, data: {} };
                    }

                    if (data.error === true || data.error === 'true') {
                        return { valid: false, error: msg.invalidCookie };
                    }

                    if (['error', 'fail', 'failed'].includes(data.status)) {
                        return { valid: false, error: msg.invalidCookie };
                    }

                    if (data.message) {
                        const m = data.message.toLowerCase();
                        if (m.includes('cookie invalid') || m.includes('cookie expired') || 
                            m.includes('suspended') || m.includes('account banned') || 
                            m.includes('authentication failed')) {
                            return { valid: false, error: msg.invalidCookie };
                        }
                    }

                    return { valid: true, data: data };
                } catch (err) {
                    return { valid: false, error: msg.apiError };
                }
            };

            const fmtTime = (sec) => {
                if (sec < 60) return `${sec}s`;
                const m = Math.floor(sec / 60);
                const s = sec % 60;
                return `${m}m ${s}s`;
            };

            const updateDisplay = () => {
                if (!currentSession) return;

                const statusEl = $('statusValue');
                const progEl = $('progressValue');
                const timeEl = $('estimatedTime');

                statusEl.textContent = currentSession.status;
                statusEl.className = 'status-value';
                
                if (currentSession.status === 'Active') cls(statusEl, 'status-active', true);
                else if (currentSession.status === 'Completed') cls(statusEl, 'status-completed', true);
                else if (currentSession.status === 'Failed') cls(statusEl, 'status-failed', true);

                progEl.textContent = `${currentSession.progress} / ${currentSession.amount}`;
                
                const pct = (currentSession.progress / currentSession.amount) * 100;
                el.progressFill.style.width = `${pct}%`;

                if (currentSession.status === 'Active' && currentSession.progress > 0) {
                    const elapsed = (Date.now() - startTimestamp) / 1000;
                    const rate = currentSession.progress / elapsed;
                    const remain = currentSession.amount - currentSession.progress;
                    const est = Math.ceil(remain / rate);
                    timeEl.textContent = fmtTime(est);
                } else if (currentSession.status === 'Completed') {
                    timeEl.textContent = 'Completed';
                } else {
                    timeEl.textContent = '—';
                }
            };

            const trackProgress = () => {
                if (!currentSession) return;
                if (progressInterval) clearInterval(progressInterval);

                let lastProg = 0;
                let stuck = 0;

                progressInterval = setInterval(() => {
                    if (!currentSession) {
                        clearInterval(progressInterval);
                        progressInterval = null;
                        return;
                    }

                    let inc;
                    const pct = (currentSession.progress / currentSession.amount) * 100;
                    
                    if (pct < 10) inc = Math.floor(Math.random() * 3) + 1;
                    else if (pct < 90) inc = Math.floor(Math.random() * 6) + 3;
                    else inc = Math.floor(Math.random() * 2) + 1;

                    currentSession.progress = Math.min(
                        currentSession.progress + inc,
                        currentSession.amount
                    );

                    if (currentSession.progress === lastProg) {
                        stuck++;
                        if (stuck > 10) currentSession.status = 'Checking';
                    } else {
                        stuck = 0;
                        lastProg = currentSession.progress;
                    }

                    if (el.statusBox.classList.contains('active')) updateDisplay();

                    if (currentSession.progress >= currentSession.amount) {
                        currentSession.status = 'Completed';
                        cls(el.sessionActive, 'show', false);
                        updateDisplay();
                        el.submit.disabled = false;
                        el.submit.style.opacity = '1';
                        clearInterval(progressInterval);
                        progressInterval = null;
                    }
                }, 3000);
            };

            el.cookie.addEventListener('input', () => clearErr(el.cookie, el.cookieErr));
            el.link.addEventListener('input', () => clearErr(el.link, el.linkErr));
            el.amount.addEventListener('input', () => clearErr(el.amount, el.amountErr));
            el.delay.addEventListener('input', () => clearErr(el.delay, el.delayErr));

            el.submit.addEventListener('click', async () => {
                if (el.submit.disabled) return;
                if (!validateInputs()) return;

                const cookie = el.cookie.value.trim();
                const link = el.link.value.trim();
                const amount = el.amount.value.trim();

                el.submit.disabled = true;
                el.submit.style.opacity = '0.5';

                const apiUrl = `https://vern-rest-api.vercel.app/api/share?key=&cookie=${encodeURIComponent(cookie)}&link=${encodeURIComponent(link)}&limit=${encodeURIComponent(amount)}`;
                
                cls(el.processing, 'show', true);

                try {
                    const valPromise = validateAPI(apiUrl);
                    const timeout = new Promise(res => setTimeout(() => res({ valid: true }), 3000));
                    const result = await Promise.race([valPromise, timeout]);

                    cls(el.processing, 'show', false);

                    if (result.valid === false) {
                        el.submit.disabled = false;
                        el.submit.style.opacity = '1';
                        showErr(el.cookie, el.cookieErr, result.error);
                        el.error.textContent = result.error;
                        cls(el.error, 'show', true);
                        setTimeout(() => cls(el.error, 'show', false), 5000);
                        return;
                    }

                    const sid = 'SHR' + Date.now().toString(36).toUpperCase();
                    const stime = new Date().toLocaleString();
                    startTimestamp = Date.now();

                    currentSession = {
                        id: sid,
                        link: link,
                        amount: parseInt(amount),
                        progress: 0,
                        status: 'Active',
                        startTime: stime,
                        apiUrl: apiUrl
                    };

                    cls(el.success, 'show', true);
                    el.sessionIdValue.textContent = sid;
                    cls(el.sessionIdDisplay, 'show', true);
                    
                    setTimeout(() => {
                        cls(el.success, 'show', false);
                        cls(el.sessionActive, 'show', true);
                        setTimeout(() => cls(el.sessionControls, 'active', true), 100);
                    }, 2000);

                    trackProgress();
                } catch (err) {
                    el.submit.disabled = false;
                    el.submit.style.opacity = '1';
                    cls(el.processing, 'show', false);
                    el.error.textContent = msg.apiError;
                    cls(el.error, 'show', true);
                    setTimeout(() => cls(el.error, 'show', false), 5000);
                }
            });

            el.checkBtn.addEventListener('click', () => {
                if (!currentSession) {
                    el.error.textContent = msg.noSession;
                    cls(el.error, 'show', true);
                    setTimeout(() => cls(el.error, 'show', false), 3000);
                    return;
                }

                $('sessionLink').textContent = currentSession.link;
                $('sessionId').textContent = currentSession.id;
                $('startTime').textContent = currentSession.startTime;
                updateDisplay();
                cls(el.statusBox, 'active', true);
                setTimeout(() => cls(el.statusBox, 'active', false), 8000);
            });

            el.deleteBtn.addEventListener('click', () => {
                if (!currentSession) return;
                if (!confirm('Are you sure you want to delete this session?')) return;

                if (progressInterval) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                }

                currentSession = null;
                startTimestamp = null;
                
                cls(el.sessionControls, 'active', false);
                cls(el.sessionActive, 'show', false);
                cls(el.statusBox, 'active', false);
                cls(el.sessionIdDisplay, 'show', false);
                
                el.submit.disabled = false;
                el.submit.style.opacity = '1';
                
                el.cookie.value = '';
                el.link.value = '';
                el.amount.value = '';
                el.delay.value = '';

                clearErr(el.cookie, el.cookieErr);
                clearErr(el.link, el.linkErr);
                clearErr(el.amount, el.amountErr);
                clearErr(el.delay, el.delayErr);
                
                el.progressFill.style.width = '0%';
            });
        })();
    </script>
</body>
</html>
